# Promise-utils
一些 promise 相关的工具函数。

### [takeLast](./src/take-last.ts)
尝试解决请求时序的问题。让异步函数的多次调用都只会返回最新的结果

使用方式：
1. 调用takeLast方法对一个函数进行包装，返回一个相同参数和返回值的新函数。

功能特性：
1. 所有的调用以最后一次调用的结果为准，前面的调用结果都会被忽略。
2. this 指向的逻辑不变。
3. TODO：可以选择让前面的调用抛出错误而不是返回最新的结果。

注意要点：
1. 会导致多次调用都会在同一时间返回相同的值。

### [Dispatcher](./src/request-dispatcher.ts)

请求调度器。

1. 一个指定大小的任务队列。
2. 每个任务带有级别（level）和优先级（priority）。
3. 进入调度器的任务会等待一个事件循环（setTimeout(0)）后开始调度。
4. 每个级别（level）在任务队列中都占有几个固定大小的槽，不同级别的任务都在其对应的槽中执行。
5. 同级别的任务由优先级（priority）细分顺序。
6. 抢占式，如果高级别的槽都已被使用，那么将去抢占比它更低级别的槽。
7. 防止饿死，采用提升级别的方式，如果一个低级别任务在多次调度中都没有被执行，那么它的级别将提升。
